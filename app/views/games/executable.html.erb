<script>
  $(function() {
    if ($(".executable-list .list-group-item.active").length == 0) {
      $(".publish-button").addClass("disabled");
      $(".publish-button").attr("disabled", "disabled");

    }

    $(".executable-list .list-group-item").click(function(e) {

      if (!$(this).hasClass("disabled")) {

        var _this = $(this);
        var selected = $(this).attr("data-file-name");

        $.ajax({url: "/game_zips/<%= @game.current_zip.id %>",
                type: "PUT",
                data: {
                  game_id: "<%= @game.id %>",
                  filename: selected
                },
                success: function(result) {
                  $(".executable-list .list-group-item").removeClass("active");
                  _this.addClass("active");
                  $(".publish-button").removeClass("disabled");
                  $(".publish-button").removeAttr("disabled", "disabled");
                }
              });

      }
    });
  });
</script>

<%= page_heading :h1, "<em>#{@game.title}</em>" %>

<%= render "breadcrumbs", active: :exec %>

<div class="col-sm-1"></div>
<div class="col-sm-9">
  <p class="note">
    Select which file the Winnitron should run to launch your game.
    <br>
    For PICO8 games, choose the html file generated by your EXPORT.
  </p>
  <ul class="executable-list list-group">
    <% selected = @game.current_zip.executable %>

    <% @game.current_zip.root_files.each do |file| %>
      <%
        possible_exec = ["exe", "html"]
        ext = file.split(".").last

        item_class = if file == selected
          item_class = "active"
        elsif !possible_exec.include?(ext)
          item_class = "disabled"
        end
      %>
      <li class="list-group-item <%= item_class %>" data-file-name="<%= file %>">
        <%= file %>
      </li>
    <% end %>
  </ul>
</div>

<div class="clearfix"></div>
<div class="col-sm-offset-8 col-sm-2">
  <% dis = @game.current_zip ? "" : "disabled" %>
  <%= link_to "Next Step", keys_game_path(@game.slug), class: "next-step btn btn-success pull-right #{dis}" %>
</div>